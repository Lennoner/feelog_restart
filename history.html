<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>그날의 기록</title>
<link rel="stylesheet" href="history.css">

<!-- html2canvas 추가 -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>

<body id="page">

<main id="capture-area" class="content">
  <p id="text" class="text"></p>
  <p id="date" class="date"></p>
</main>

<button id="saveImg" class="save-btn">이미지로 저장하기</button>

<script>
const params = new URLSearchParams(location.search);
const id = params.get("id");
const arr = JSON.parse(localStorage.getItem("feelog") || "[]");
const entry = arr.find(e => e.id === id);

// 밝기 계산 (검정/흰색 자동 선택)
function getLuma(hex) {
  hex = hex.replace("#", "");
  const r = parseInt(hex.substring(0,2),16);
  const g = parseInt(hex.substring(2,4),16);
  const b = parseInt(hex.substring(4,6),16);
  return 0.2126*r + 0.7152*g + 0.0722*b;
}

if (entry) {
  const bg = entry.color;
  document.getElementById("page").style.background = bg;

  const luma = getLuma(bg);
  const textColor = (luma < 140) ? "#ffffff" : "#000000";
  document.body.style.color = textColor;

  const d = new Date(entry.date);
  const formatted = `${d.getFullYear()}.${String(d.getMonth()+1).padStart(2,'0')}.${String(d.getDate()).padStart(2,'0')}`;
  
  document.getElementById("text").textContent = entry.text;
  document.getElementById("date").textContent = formatted;
} else {
  document.getElementById("text").textContent = "기록을 찾을 수 없어요.";
}

/* === 이미지 저장 기능 === */
document.getElementById("saveImg").addEventListener("click", () => {
  // 전체 페이지(배경색 포함)를 캡처
  const target = document.getElementById("page");
  const bgColor = getComputedStyle(target).backgroundColor;

  html2canvas(target, {
    scale: 2,
    backgroundColor: bgColor   // 배경색을 강제로 지정
  }).then(canvas => {
    const link = document.createElement("a");
    link.download = "feelog_record.png";
    link.href = canvas.toDataURL("image/png");
    link.click();
  });
});

</script>

</body>
</html>


